<!DOCTYPE html>
<!-- Define o idioma do documento como Portugu√™s do Brasil -->
<html lang="pt-BR">
<head>
  <!-- Configura√ß√µes b√°sicas de codifica√ß√£o e viewport -->
  <meta charset="UTF-8">                                           <!-- Garante suporte a caracteres especiais -->
  <meta name="viewport" content="width=device-width,initial-scale=1"> <!-- Configura√ß√£o para responsividade mobile -->
  
  <!-- T√≠tulo da p√°gina que aparece na aba do navegador -->
  <title>About Us - Leave Your Trip to Us</title>
  
  <!-- Importa√ß√£o de estilos CSS -->
  <link rel="stylesheet" href="styles.css">                       <!-- Estilos principais do site -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins&display=swap" rel="stylesheet"> <!-- Fontes personalizadas do Google -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"> <!-- Biblioteca de √≠cones -->
  
  <!-- Scripts JavaScript necess√°rios -->
  <script src="js/page-transitions.js" defer></script>            <!-- Sistema de transi√ß√µes de p√°gina (carregamento defer) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script> <!-- Biblioteca para busca fuzzy -->
</head>
<body>

    <!-- Conte√∫do espec√≠fico da p√°gina -->
  <main>

    <section class="search-results">
      <div class="search-results-text">
        <h4>Explore your 
    next destination at</h4>
        
        <button id="more-informations" type="button">Leave your trip with us, can I have everything ready for the trip of your dreams?üëç</button>
        <ul>
        <div class="cities-recommendation">
        <h5>Recommended Cities</h5>
        <li id="'cities-recommendation-list">
            <script>
                // Adicione esta fun√ß√£o antes da fun√ß√£o loadFragment
/**
 * Fun√ß√£o que reexecuta scripts dentro de fragmentos HTML carregados dinamicamente
 * @param {HTMLElement} container - Elemento contendo os scripts a serem reexecutados
 */
function runFragmentScripts(container) {
  // Busca todos os elementos <script> dentro do container
  const scripts = container.getElementsByTagName('script');
  
  // Itera sobre cada script encontrado
  Array.from(scripts).forEach(script => {
    // Cria um novo elemento <script> para reexecu√ß√£o
    const newScript = document.createElement('script');
    
    // Copia todos os atributos do script original (src, type, etc)
    Array.from(script.attributes).forEach(attr => {
      newScript.setAttribute(attr.name, attr.value);
    });
    
    // Copia o conte√∫do interno do script (c√≥digo JavaScript)
    newScript.textContent = script.textContent;
    
    // Substitui o script original pelo novo (for√ßa reexecu√ß√£o)
    script.parentNode.replaceChild(newScript, script);
  });
}

    // carrega um fragmento HTML e injeta no container especificado
    function loadFragment(url, containerId) {
      fetch(url)
        .then(function(response) {
          if (!response.ok) throw new Error('Network response was not ok: ' + response.status);
          return response.text();
        })
        .then(function(html) {
          var container = document.getElementById(containerId);
          if (!container) return;
          container.innerHTML = html;
          markActiveLink(container);
          runFragmentScripts(container); // Agora esta fun√ß√£o existe
          // Adiciona os event listeners ap√≥s carregar o header
          if (containerId === 'shared-header') {
            setupHeaderButtons();
          }
        })
        .catch(function(err) {
          console.error('Erro ao carregar fragmento:', err);
        });
    }

    // aplica classe .active ao link que corresponde √† p√°gina atual
    function markActiveLink(container) {
      try {
        var containerEl = typeof container === 'string' ? document.getElementById(container) : container;
        if (!containerEl) return;
        var links = containerEl.querySelectorAll('a[href]');
        var current = window.location.pathname.split('/').pop() || 'index.html';
        links.forEach(function(a) {
          var href = (a.getAttribute('href') || '').split('/').pop();
          if (href === current) a.classList.add('active');
        });
      } catch (e) {
        console.error('markActiveLink error:', e);
      }
    }

    // configura os bot√µes do header
    // Add this helper function for text normalization
/**
 * Normaliza texto para busca removendo acentos e padronizando caracteres
 * @param {string} text - Texto a ser normalizado
 * @returns {string} Texto normalizado em min√∫sculas, sem acentos e espa√ßos extras
 */
function normalizeText(text) {
  // Valida√ß√£o de entrada para evitar erros
  if (!text || typeof text !== 'string') {
    return '';
  }
  
  return text
    .toLowerCase()                // Converte para min√∫sculas
    .trim()                      // Remove espa√ßos no in√≠cio e fim
    .normalize('NFD')            // Decomp√µe caracteres acentuados
    .replace(/[\u0300-\u036f]/g, ''); // Remove diacr√≠ticos (acentos)
}

/**
 * Configura os bot√µes de busca e suas funcionalidades
 * Implementa a l√≥gica de busca fuzzy usando Fuse.js
 * 
 */
let headerInitialized = false; // Flag para evitar m√∫ltiplas inicializa√ß√µes
function setupHeaderButtons() {
  if (headerInitialized) {
    console.log('[DEBUG] Header already initialized, ignorando');
    return; // Evita inicializa√ß√µes duplicadas
  }
  headerInitialized = true;
  const searchBtn = document.getElementById('btnSearch');   // Bot√£o de busca
  const cleanBtn = document.getElementById('clean');        // Bot√£o para limpar busca
  const searchInput = document.getElementById('Research');  // Campo de entrada da busca
  const resultsContainer = document.getElementById('results');

  // Protege contra elementos n√£o encontrados
  if (searchBtn && searchInput) {
    searchBtn.addEventListener('click', async () => {
      console.log('[DEBUG] Clique no bot√£o Search detectado');
      if (!searchInput.value) return;

      console.log('[DEBUG] Iniciando busca por:', searchInput.value);
      try {
        const results = await searchDatabase(normalizeText(searchInput.value));
        displayRecommendations(results);
      } catch (error) {
        console.error('Search failed:', error);
        showErrorMessage();
        hearderInitialized = true; // Reset flag on error
      }
    });
  }

  if (cleanBtn && searchInput) {
    cleanBtn.addEventListener('click', () => {
      searchInput.value = '';
      clearSearchResults();
    });
  }
}

/**
 * Fun√ß√µes auxiliares para processamento dos resultados da busca
 */

/**
 * Agrupa os resultados da busca por categoria (pa√≠ses, templos, praias)
 * @param {Array} results - Resultados brutos da busca com Fuse.js
 * @returns {Object} Objeto com arrays separados por categoria
 */
function groupSearchResults(results) {
  // Inicializa objeto para armazenar resultados agrupados
  const grouped = {
    countries: [],    // Array para armazenar pa√≠ses encontrados
    temples: [],      // Array para armazenar templos encontrados
    beaches: []       // Array para armazenar praias encontradas
  };

  results.forEach(result => {
    const { item, score } = result;
    
    if (item.countries) {
      grouped.countries.push(...item.countries);
    }
    if (item.temples) {
      grouped.temples.push(...item.temples);
    }
    if (item.beaches) {
      grouped.beaches.push(...item.beaches);
    }
  });

  return grouped;
}

/**
 * Exibe os resultados da busca na interface do usu√°rio
 * @param {Object} results - Resultados agrupados por categoria
 */
function displaySearchResults(results) {
  // Busca ou cria o container para exibir resultados
  let resultsContainer = document.getElementById('search-results');
  // Se o container n√£o existir, cria um novo
  if (!resultsContainer) {
    resultsContainer = document.createElement('div');
    resultsContainer.id = 'search-results';
    document.querySelector('main').appendChild(resultsContainer);
  }

  resultsContainer.innerHTML = `
    <div class="results-grid">
      ${Object.entries(results).map(([category, items]) => `
        <div class="category-section">
          <h3>${category.charAt(0).toUpperCase() + category.slice(1)}</h3>
          <div class="items-grid">
            ${items.map(item => `
              <div class="result-card">
                <img src="${item.imageUrl || './images/placeholder.png'}" 
                     alt="${item.name || 'Image'}"
                     onerror="this.onerror=null; this.src='./images/placeholder.png';">
                <h4>${item.name || 'Unnamed Location'}</h4>
                <p>${item.description || 'No description available'}</p>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

/**
 * Limpa os resultados da busca da interface
 * Chamado quando o usu√°rio limpa o campo de busca ou inicia nova busca
 */
function clearSearchResults() {
  // Busca o container de resultados
  const resultsContainer = document.getElementById('search-results');
  // Se existir, limpa seu conte√∫do
  if (resultsContainer) {
    resultsContainer.innerHTML = '';
  }
}

/**
 * Mapeamento de termos em portugu√™s para ingl√™s e categorias relacionadas
 * Usado para melhorar a busca com sin√¥nimos e termos relacionados
 * @constant {Object}
 */
//O AJAX JA LIDA COM ERROS DE DIGITA√á√ÉO OU ACENTO, PLURAL AUTOMATICO ?ENTAO N PRECISA DISSO
const termMapper = {
  // Mapeamento direto portugu√™s-ingl√™s
  'praia': 'beach',     // Termo singular
  'praias': 'beach',    // Termo plural
  'templo': 'temple',   // Termo singular
  'templos': 'temples', // Termo plural
  'pais': 'country',
  'paises': 'countries',
  'carnaval': ['Rio de Janeiro', 'Brazil', 'festival'],
  'samba': ['Rio de Janeiro', 'Brazil', 'culture'],
  'surf': ['beach', 'water sports'],
  'mergulho': ['beach', 'diving', 'water sports'],
  'historia': ['temple', 'culture', 'history'],
  'cultura': ['temple', 'culture', 'history'],
  'relaxar': ['beach', 'spa', 'resort'],
  'aventura': ['nature', 'wildlife', 'sports'],
  'natureza': ['nature', 'wildlife', 'park'],
  'cidade': ['urban', 'city'],
  'compras': ['urban', 'shopping'],
  'gastronomia': ['food', 'culture']
};

  // carregar header e footer (caminhos relativos)
    loadFragment('fragments/header.html', 'shared-header');
    loadFragment('fragments/footer.html', 'shared-footer');

    // comportamento do bot√£o hero: rolar at√© o footer
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'more-informations') {
        var footer = document.getElementById('shared-footer');
        if (footer) footer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });

    // comportamento dos bot√µes do header (search / reset) - exemplo simples
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'btnSearch') {
        var q = document.getElementById('Research') ? document.getElementById('Research').value : '';
        alert('Pesquisar por: ' + q);
      }
      if (e.target && e.target.id === 'clean') {
        if (document.getElementById('Research')) document.getElementById('Research').value = '';
      }
    });
            </script>
         
        </ul>
    </div>
    
    </div>
      <div style="height:4000px"></div>
                                  <!-- espa√ßo demo para rolagem -->
    </section>
  </main>

<!-- header compartilhado ser√° injetado aqui -->
<div id="shared-header"></div>

  <!-- Conte√∫do espec√≠fico da p√°gina About Us -->
<main>
<div class="contact_us-page">
    <h1>Contact Us</h1>
</div>
<div class="table-placeholder">
    <h2>Name</h2>
    <input type="text" id="Name" placeholder="Enter your name" aria-label="Name">
    <h3>Email</h3>
    <input type="text" id="Email" placeholder="Enter your email" aria-label="Email">
    <h4>Message</h4>
    <input type="text" id="Message" placeholder="Enter your message" aria-label="Message">
    <button class="Submit" type="button">Submit</button>
</div>
</main>
  <!-- footer compartilhado ser√° injetado aqui -->
  <div id="shared-footer"></div>

  <script>
    // carregar fragments (caminhos relativos)
    /**
 * Carrega fragmentos HTML (header/footer) dinamicamente via AJAX
 * @param {string} url - URL do fragmento a ser carregado
 * @param {string} containerId - ID do elemento onde o fragmento ser√° inserido
 */
function loadFragment(url, containerId) {
      // Faz requisi√ß√£o HTTP para buscar o fragmento
      fetch(url)
        .then(function(response) {
          // Verifica se a resposta √© v√°lida
          if (!response.ok) throw new Error('Network response was not ok: ' + response.status);
          // Converte resposta para texto
          return response.text();
        })
        .then(function(html) {
          // Busca o container onde o fragmento ser√° inserido
          var container = document.getElementById(containerId);
          if (!container) return;
          // Insere o HTML e atualiza links ativos
          container.innerHTML = html;
          markActiveLink(container);
        })
        .catch(function(err) {
          // Log de erro se algo falhar
          console.error('Erro ao carregar fragmento:', err);
        });
    }

    // destaque do link ativo no menu
    function markActiveLink(container) {
      var el = typeof container === 'string' ? document.getElementById(container) : container;
      if (!el) return;
      var links = el.querySelectorAll('a[href]');
      var current = window.location.pathname.split('/').pop() || 'index.html';
      links.forEach(function(a) {
        var hrefFile = (a.getAttribute('href') || '').split('/').pop();
        if (hrefFile === current) a.classList.add('active'); else a.classList.remove('active');
      });
    }

    // comportamento dos bot√µes de contato (exemplo)
    document.addEventListener('click', function(e) {
      var btn = e.target.closest('.btn-contact');
      if (!btn) return;
      var name = btn.dataset.name || 'Contato';
      var msg = prompt('Enviar mensagem para ' + name + '\nDigite sua mensagem:');
      if (msg) alert('Mensagem enviada a ' + name + ':\n\n' + msg);
    });

    

  </script>
  </li>
  </ul>
</body>
</html>